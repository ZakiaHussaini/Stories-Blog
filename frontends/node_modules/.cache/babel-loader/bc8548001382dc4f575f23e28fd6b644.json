{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/zakia.hussaini/Documents/Stories-Blog-1/frontends/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/zakia.hussaini/Documents/Stories-Blog-1/frontends/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/zakia.hussaini/Documents/Stories-Blog-1/frontends/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{createContext,useContext,useEffect,useMemo,useState}from\"react\";import axios from\"axios\";import{axiosReq,axiosRes}from\"../api/axiosDefaults\";import{useHistory}from\"react-router\";import{removeTokenTimestamp,shouldRefreshToken}from\"../utils/utils\";import{jsx as _jsx}from\"react/jsx-runtime\";export var CurrentUserContext=/*#__PURE__*/createContext();export var SetCurrentUserContext=/*#__PURE__*/createContext();export var useCurrentUser=function useCurrentUser(){return useContext(CurrentUserContext);};export var useSetCurrentUser=function useSetCurrentUser(){return useContext(SetCurrentUserContext);};export var CurrentUserProvider=function CurrentUserProvider(_ref){var children=_ref.children;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),currentUser=_useState2[0],setCurrentUser=_useState2[1];var history=useHistory();var handleMount=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$axiosRes$get,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axiosRes.get(\"dj-rest-auth/user/\");case 3:_yield$axiosRes$get=_context.sent;data=_yield$axiosRes$get.data;setCurrentUser(data);_context.next=10;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);case 10:case\"end\":return _context.stop();}},_callee,null,[[0,8]]);}));return function handleMount(){return _ref2.apply(this,arguments);};}();useEffect(function(){handleMount();},[]);useMemo(function(){axiosReq.interceptors.request.use(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(config){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!shouldRefreshToken()){_context2.next=11;break;}_context2.prev=1;_context2.next=4;return axios.post(\"/dj-rest-auth/token/refresh/\");case 4:_context2.next=11;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](1);setCurrentUser(function(prevCurrentUser){if(prevCurrentUser){history.push(\"/signin\");}return null;});removeTokenTimestamp();return _context2.abrupt(\"return\",config);case 11:return _context2.abrupt(\"return\",config);case 12:case\"end\":return _context2.stop();}},_callee2,null,[[1,6]]);}));return function(_x){return _ref3.apply(this,arguments);};}(),function(err){return Promise.reject(err);});axiosRes.interceptors.response.use(function(response){return response;},/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(err){var _err$response;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(!(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401)){_context3.next=11;break;}_context3.prev=1;_context3.next=4;return axios.post(\"/dj-rest-auth/token/refresh/\");case 4:_context3.next=10;break;case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](1);setCurrentUser(function(prevCurrentUser){if(prevCurrentUser){history.push(\"/signin\");}return null;});removeTokenTimestamp();case 10:return _context3.abrupt(\"return\",axios(err.config));case 11:return _context3.abrupt(\"return\",Promise.reject(err));case 12:case\"end\":return _context3.stop();}},_callee3,null,[[1,6]]);}));return function(_x2){return _ref4.apply(this,arguments);};}());},[history]);return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsx(SetCurrentUserContext.Provider,{value:setCurrentUser,children:children})});};","map":{"version":3,"names":["createContext","useContext","useEffect","useMemo","useState","axios","axiosReq","axiosRes","useHistory","removeTokenTimestamp","shouldRefreshToken","jsx","_jsx","CurrentUserContext","SetCurrentUserContext","useCurrentUser","useSetCurrentUser","CurrentUserProvider","_ref","children","_useState","_useState2","_slicedToArray","currentUser","setCurrentUser","history","handleMount","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$axiosRes$get","data","wrap","_callee$","_context","prev","next","get","sent","t0","stop","apply","arguments","interceptors","request","use","_ref3","_callee2","config","_callee2$","_context2","post","prevCurrentUser","push","abrupt","_x","err","Promise","reject","response","_ref4","_callee3","_err$response","_callee3$","_context3","status","_x2","Provider","value"],"sources":["C:/Users/zakia.hussaini/Documents/Stories-Blog-1/frontends/src/contexts/CurrentUserContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useMemo, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { axiosReq, axiosRes } from \"../api/axiosDefaults\";\r\nimport { useHistory } from \"react-router\";\r\nimport { removeTokenTimestamp, shouldRefreshToken } from \"../utils/utils\";\r\n\r\nexport const CurrentUserContext = createContext();\r\nexport const SetCurrentUserContext = createContext();\r\n\r\nexport const useCurrentUser = () => useContext(CurrentUserContext);\r\nexport const useSetCurrentUser = () => useContext(SetCurrentUserContext);\r\n\r\nexport const CurrentUserProvider = ({ children }) => {\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  const history = useHistory();\r\n\r\n  const handleMount = async () => {\r\n    try {\r\n      const { data } = await axiosRes.get(\"dj-rest-auth/user/\");\r\n      setCurrentUser(data);\r\n    } catch (err) {\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    handleMount();\r\n  }, []);\r\n\r\n  useMemo(() => {\r\n    axiosReq.interceptors.request.use(\r\n      async (config) => {\r\n        if (shouldRefreshToken()) {\r\n          try {\r\n            await axios.post(\"/dj-rest-auth/token/refresh/\");\r\n          } catch (err) {\r\n            setCurrentUser((prevCurrentUser) => {\r\n              if (prevCurrentUser) {\r\n                history.push(\"/signin\");\r\n              }\r\n              return null;\r\n            });\r\n            removeTokenTimestamp()\r\n            return config;\r\n          }\r\n        }\r\n        \r\n        return config;\r\n      },\r\n      (err) => {\r\n        return Promise.reject(err);\r\n      }\r\n    );\r\n\r\n    axiosRes.interceptors.response.use(\r\n      (response) => response,\r\n      async (err) => {\r\n        if (err.response?.status === 401) {\r\n          try {\r\n            await axios.post(\"/dj-rest-auth/token/refresh/\");\r\n          } catch (err) {\r\n            setCurrentUser((prevCurrentUser) => {\r\n              if (prevCurrentUser) {\r\n                history.push(\"/signin\");\r\n              }\r\n              return null;\r\n            });\r\n            removeTokenTimestamp()\r\n          }\r\n          return axios(err.config);\r\n        }\r\n        return Promise.reject(err);\r\n      }\r\n    );\r\n  }, [history]);\r\n\r\n  return (\r\n    <CurrentUserContext.Provider value={currentUser}>\r\n      <SetCurrentUserContext.Provider value={setCurrentUser}>\r\n        {children}\r\n      </SetCurrentUserContext.Provider>\r\n    </CurrentUserContext.Provider>\r\n  );\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}